<!DOCTYPE html>
<html>
<head>
    <title>Claude.ai Detection Test</title>
    <meta name="description" content="Test page for Ginko Claude detection">
</head>
<body>
    <h1>Claude.ai Detection Test Page</h1>
    
    <!-- Simulate various Claude interface elements -->
    
    <!-- Primary elements (current selectors) -->
    <div data-testid="conversation" id="test-conversation">
        <div data-testid="message">Test message from user</div>
        <div data-testid="message">Test message from Claude</div>
    </div>
    
    <form>
        <textarea data-testid="chat-input" placeholder="Message Claude..." id="test-chat-input"></textarea>
        <button data-testid="send-button">Send</button>
    </form>
    
    <!-- Generic elements that might be found -->
    <textarea placeholder="Ask Claude anything..."></textarea>
    <div contenteditable="true" role="textbox" aria-label="Message input"></div>
    
    <!-- Text-based detection -->
    <div>Chat with Claude</div>
    <button>Send message</button>
    
    <!-- Elements that should NOT be detected -->
    <div class="advertisement">Advertisement content</div>
    <input type="text" placeholder="Search..." class="search-input">
    
    <script>
        // Simulate the Chrome extension environment
        window.chrome = {
            runtime: {
                sendMessage: (message, callback) => {
                    console.log('Mock Chrome message:', message);
                    if (callback) {
                        callback({ success: true });
                    }
                    return Promise.resolve({ success: true });
                },
                onMessage: {
                    addListener: (callback) => {
                        console.log('Mock message listener added');
                    }
                }
            }
        };
        
        // Set up fake Claude.ai URL
        history.replaceState(null, null, 'https://claude.ai/chat/test-conversation');
        
        console.log('Test environment set up');
    </script>
    
    <script src="content.js"></script>
    
    <script>
        // Test the detection after a delay to simulate dynamic loading
        setTimeout(() => {
            console.log('\n=== RUNNING DETECTION TESTS ===');
            
            // Test detection
            const hasInterface = ginkoContent.detectClaudeInterface();
            console.log('Detection result:', hasInterface);
            console.log('Elements found:', Object.keys(ginkoContent.claudeElements));
            
            // Test individual detection strategies
            console.log('\n=== TESTING INDIVIDUAL STRATEGIES ===');
            
            ginkoContent.claudeElements = {};
            ginkoContent.detectPrimaryElements();
            console.log('Primary elements:', Object.keys(ginkoContent.claudeElements));
            
            ginkoContent.claudeElements = {};
            ginkoContent.detectGenericChatElements();
            console.log('Generic elements:', Object.keys(ginkoContent.claudeElements));
            
            ginkoContent.claudeElements = {};
            ginkoContent.detectByClaudeText();
            console.log('Text-based elements:', Object.keys(ginkoContent.claudeElements));
            
            ginkoContent.claudeElements = {};
            ginkoContent.detectByURLPatterns();
            console.log('URL pattern elements:', Object.keys(ginkoContent.claudeElements));
        }, 1000);
    </script>
</body>
</html>